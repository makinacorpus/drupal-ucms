parameters:
  ucms_contrib.filter.view_mode.wysiwyg: wysiwyg
  ucms_contrib.filter.view_mode.markup: default

services:

  # Site storage responsible for loading and updating site data
  ucms_contrib.cart.default:
    public: false
    class: MakinaCorpus\Ucms\Contrib\Cart\CartStorage
    arguments: ["@database"]
  ucms_contrib.cart.bloom:
    public: false
    class: MakinaCorpus\Ucms\Contrib\Cart\BloomCartStorage
    arguments: ["@ucms_contrib.cart.default", "@cache.default"]
  ucms_contrib.cart:
    public: true
    alias: ucms_contrib.cart.bloom
    class: MakinaCorpus\Ucms\Contrib\Cart\CartStorage

  ucms_contrib.node_action_provider:
    public: false
    class: MakinaCorpus\Ucms\Contrib\Action\NodeActionProvider
    arguments: ["@ucms_site.node_access_helper", "@ucms_site.manager", "@current_user", "@ucms_contrib.cart"]
    tags: [{name: ucms_dashboard.action_provider}]

  ucms_contrib.content_action_provider:
    public: false
    arguments: ["@ucms_contrib.type_handler", "@ucms_site.manager", "@current_user", "@ucms_site.node_access_helper"]
    class: MakinaCorpus\Ucms\Contrib\Action\ContentActionProvider
    tags: [{name: ucms_dashboard.action_provider}]

  ucms_contrib.site_action_provider:
    public: false
    arguments: ["@ucms_site.manager", "@current_user"]
    class: MakinaCorpus\Ucms\Contrib\Action\SiteActionProvider
    tags: [{name: ucms_dashboard.action_provider}]

  ucms_contrib.context_pane_event_listener:
    public: true
    class: MakinaCorpus\Ucms\Contrib\EventDispatcher\ContextPaneEventListener
    arguments:
      - "@ucms_contrib.content_action_provider"
      - "@ucms_dashboard.action_provider_registry"
      - "@ucms_site.manager"
      - "@ucms_contrib.type_handler"
    tags:
      - { name: event_listener, event: ucms_dashboard.context_init }

  # Datasource via elastic search
  ucms_contrib.datasource.elastic:
    shared: false
    class: MakinaCorpus\Ucms\Contrib\PrivateNodeDataSource
    arguments: ["@ucms_search.search_factory", "@ucms_site.manager", "@entity.manager", "@current_user"]

  # Content portlet
  ucms_contrib.content_portlet:
    public: false
    class: MakinaCorpus\Ucms\Contrib\Portlet\ContentPortlet
    arguments: ["@ucms_contrib.datasource.elastic", "@ucms_contrib.content_action_provider", "@ucms_contrib.type_handler", "@ucms_site.manager", "@current_user"]
    tags: [{ name: ucms_dashboard.portlet }]

  # Media portlet
  ucms_contrib.media_portlet:
    public: false
    class: MakinaCorpus\Ucms\Contrib\Portlet\MediaPortlet
    arguments: ["@ucms_contrib.datasource.elastic", "@ucms_contrib.content_action_provider", "@ucms_contrib.type_handler", "@ucms_site.manager", "@current_user"]
    tags: [{ name: ucms_dashboard.portlet }]

  # Component responsible for providing content type context
  ucms_contrib.type_handler:
    public: true
    class: MakinaCorpus\Ucms\Contrib\TypeHandler

  ucms_contrib.media.subscriber:
    public: true
    class: MakinaCorpus\Ucms\Contrib\EventDispatcher\MediaReferenceEventListener
    tags: [{ name: event_subscriber }]

  ucms_contrib.node_subscriber:
    public: true
    class: MakinaCorpus\Ucms\Contrib\EventDispatcher\NodeEventSubscriber
    arguments: ["@database"]
    tags: [{ name: event_subscriber }]

  ucms_contrib.node_access.subscriber:
    public: true
    class: MakinaCorpus\Ucms\Contrib\NodeAccess\NodeAccessEventSubscriber
    arguments: ["@ucms_site.manager", "@ucms_contrib.type_handler"]
    tags: [{ name: event_subscriber }]

  ucms_contrib.node_index_subscriber:
    public: true
    class: MakinaCorpus\Ucms\Contrib\EventDispatcher\NodeIndexEventSubscriber
    tags: [{ name: event_subscriber }]
