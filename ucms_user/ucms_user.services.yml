services:

  # Token manager
  ucms_user.token_manager:
    public: true
    class: MakinaCorpus\Ucms\User\TokenManager
    arguments: ["@database"]

  ucms_user.user_event_listener:
    public: true
    class: MakinaCorpus\Ucms\User\EventDispatcher\UserEventListener
    arguments: ["@entity.manager", "@ucms_user.token_manager"]
    tags:
      - {name: event_listener, event: "site:webmaster_add_new"}

  # Data source service for listing page
  ucms_user.admin.datasource:
    public: true
    class: MakinaCorpus\Ucms\User\Page\UserAdminDatasource
    arguments: ["@database", "@ucms_site.access", "@entity.manager"]

  # Action provider for the listing page
  ucms_user.action_provider:
    public: false
    class: MakinaCorpus\Ucms\User\Action\UserActionProvider
    arguments: ["@current_user"]
    tags: [{name: ucms_dashboard.action_provider}]

  # Context pane event listener to provide the user creation button
  ucms_user.context_pane_event_listener:
    public: true
    class: MakinaCorpus\Ucms\User\EventDispatcher\ContextPaneEventListener
    tags: [{ name: event_listener, event: ucms_dashboard.context_init }]

  # Dashboard event listener to provide portlets
  ucms_user.dashboard_event_listener:
    public: true
    class: MakinaCorpus\Ucms\User\EventDispatcher\DashboardEventListener
    tags: [{name: event_listener, event: ucms_dashboard.dashboard_init}]

  # Account portlet
  ucms_user.account_portlet:
    public: false
    class: MakinaCorpus\Ucms\User\Portlet\AccountPortlet
    tags: [{ name: ucms_dashboard.portlet }]

  # Users portlet
  ucms_user.users_portlet:
    public: false
    class: MakinaCorpus\Ucms\User\Portlet\UsersPortlet
    arguments: ["@ucms_user.admin.datasource", "@ucms_site.manager"]
    tags: [{ name: ucms_dashboard.portlet }]